!SLIDE cover

h1. Ruby Code Performance Tweaks

* DRAFT <%= Date.today.to_s %>
* Kurt Stephens - kurt@enovafinancial.com
* Enova Financial

!SLIDE

h1. Why bother?

* Layers.
* Common Ruby idioms are (sometimes):
** Concise
** Elegant
** Performant
* Ruby platforms and language versions perform differently with the same code.

!SLIDE

h1. Layers 

* Decomposition
* Reuse, Reliability
* Layer Pyramids become Dependency Funnels
* Lower layers are bottlenecks, until they are tuned.

!SLIDE

h1. Pyramid

<object data="image/code_pyramid.svg" />

!SLIDE

h1. Funnel

<object data="image/code_funnel.svg" />

!SLIDE

h1. Ruby Platforms

<% Platform.instances.each do | plat | %>
* <%= plat.name %>
<%= plat.details %>
<% end %>

!SLIDE

h1. Problems

* Small problems become big problems.
* Common idioms are born from common problems.

!SLIDE

h1. Idioms

h2. make friends with: 
* programmers - efficency, style
* platforms - implementation techniques
* algorithms - O(1), O(N), O(log N), O(N ^ 2)
* space - structure, allocation and garbage collection costs
* time - is money

h2. The best performing idiom might:
* not be the most elegant idiom.
* might not be the most intuitive idiom.
* might not work best for your platform.

!SLIDE

h1. Thoughts

h2. These Benchmarks:
* are very low-level, narrow and specific.
* will not extrapolate to represent your application's overall performance.
* are not comprehensive or real-world comparisons of different Ruby platforms.
* may be due to misconfiguration - run these tests yourself.

h2. Stuff gets better:
* Ruby platforms get better.
* These benchmark results could change tomorrow.
* Contribute to the community.

h2. Do your own research
* Dis-spell your own myths.
* See what works for you.
* Fix code before blaming Ruby - clean, profiled code works best everywhere.
* Measure, then measure again.


<% Problem.instances.each do | prob | %>

!SLIDE

h1. Problem: <%= prob.name %>

<%= prob.description %>

@@@ ruby
<%= prob.setup unless prob.example %>
<%= case
when x = prob.example
  x
else
  prob.around.gsub(/\b__SOLUTION__\b/, '# SOLUTION?')
end
%>
@@@
<%= prob.notes %>

<% prob.solutions.each do | sol | %>

!SLIDE

h1. Problem: <%= prob.name %>

h1. Solution <%= sol.index %>: @<%= sol.name %>@

@@@ ruby
<%= prob.setup %>
<%= sol.example || sol.code_block %>
@@@

<%= sol.notes %>

<% end %>

!SLIDE

<% code_rb = "problem/#{prob.name}.rb" %>
<% out_txt = "measurement/#{prob.name}.txt" %>

h1. Results

* n = <%= prob.n * ', ' %>
* Test script: "":relative:<%= code_rb %>
* Test output: "":relative:<%= out_txt %>
* Measurements by platform:
<% prob.platforms.each do | plat |
     measurement_rb = "measurement/#{prob.name}-#{plat.name}.rb" %>
** <%= plat.name %>: "":relative:<%= measurement_rb %>
<% end %>

<% prob.platforms.each do | plat | %>
!SLIDE

!image/<%= prob.name %>-<%= plat.name %>.png!

<% end %>

<% prob.solutions.each do | sol | %>
!SLIDE

!image/<%= prob.name %>-sol<%= sol.index %>.png!

<% end %>

<% if prob.synopsis %>
!SLIDE

h1. Problem: <%= prob.name %>

<%= prob.synopsis %>
<% end %>

<% end %>

!SLIDE

h1. But wait there's more.

!SLIDE

h1. More Info

http://github.com/kstephens/ruby_code_tweaks



